build_development:
  extends: .build_template

test_development:
  extends: .test_template
  dependencies:
    - build_development

deploy_development:
  extends: .deploy_template
  dependencies:
    - build_development
  variables:
    NODE_ENV: development
    CF_API_TOKEN: $DEV_CF_API_TOKEN
    CF_ACCOUNT_ID: $DEV_CF_ACCOUNT_ID

read_secure_file:
  stage: test
  variables:
    SECURE_FILES_DOWNLOAD_PATH: './secure_files/'  # Optional: Customize the download path
  script:
    # Download and execute the secure files tool
    - curl --silent "https://gitlab.com/gitlab-org/incubation-engineering/mobile-devops/download-secure-files/-/raw/main/installer" | bash
    # Check if files were downloaded correctly
    - echo "Listing secure files in ${SECURE_FILES_DOWNLOAD_PATH:-.secure_files}:"
    - ls -la ${SECURE_FILES_DOWNLOAD_PATH:-.secure_files}
    # Attempt to read the secure file
    - echo "Reading contents of .dev.vars:"
    - cat ${SECURE_FILES_DOWNLOAD_PATH:-.secure_files}/.dev.vars || echo "Secure file '.dev.vars' not found!"
  rules:
    - when: always

